<!DOCTYPE html>
<html>
<head>
  <title>查詢</title>
</head>
<body>
  <h1>查詢頁面</h1>
  <script src="https://cdn.socket.io/4.5.3/socket.io.min.js"
    integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi"
    crossorigin="anonymous"></script>
  <script src='//cdn.jsdelivr.net/npm/sweetalert2@11'></script>
  <script>
    const STATUS = {
      FAIL: -1,
      STANDBY: 0,
      SUCCESS: 1,
      PAID: 2,
    };
    console.log('I am lookup page!');
    const access_token = window.localStorage.getItem('access_token');
    console.log(access_token);

    const socket = io({
      auth: {
        token: access_token
      }
    });
    socket.on('notify', (result) => {
      console.log('Result is', result);
      if(result === STATUS.SUCCESS) {
        Swal.fire({
          icon: 'success',
          title: '搶購成功',
          showConfirmButton: false,
          timer: 1500,
        });
        // 搶購成功後，導向結帳頁面
        setTimeout(() => {
          window.location.href = '/checkout.html';
        }, 1500);
      }
      if (result === STATUS.STANDBY) {
        Swal.fire({
          icon: 'success',
          title: '候補中',
          showConfirmButton: false,
          timer: 1500,
        });
      }
      if (result === STATUS.FAIL) {
        Swal.fire({
          icon: 'info',
          title: '搶購失敗',
          showConfirmButton: false,
          timer: 1500,
        });
        // 搶購失敗後，導向首頁
        setTimeout(() => {
          window.location.href = '/home.html';
        }, 1500);
      }
    });
    socket.on('connect_error', () => {
      console.error('connect error')
    })
  </script>
</body>
</html>